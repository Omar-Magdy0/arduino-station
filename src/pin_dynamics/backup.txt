#include "pin_dynamics.h"
#include <Arduino.h>

#define mainButton 13
#define mainPot 17

void mainPinModer(){
pinMode(13,INPUT_PULLUP); pinMode(17,INPUT);    
}





 enum State{
idle,
releaseWatchDog,
debounceTime,
doubleClickChecker,
};


State currentState = idle;
extern unsigned long currentTime;
unsigned long startTime,firstShortClickStart;
uint8_t debounceWait = 50,shortClickCount = 0;


#define maxShortClickTime 200
#define maxLongClickTime 2000


int8_t gesture(){
switch (currentState)
{
case idle:
if(digitalRead(mainButton)==LOW){startTime = millis();currentState = releaseWatchDog;};
break;

case releaseWatchDog:
unsigned long timeOfClick;
if((digitalRead(mainButton)==HIGH)){
    int8_t clickytype;
    timeOfClick = currentTime - startTime;
    if (timeOfClick < maxShortClickTime){shortClickCount++;if(shortClickCount == 1)firstShortClickStart = currentTime;}
    else if ((timeOfClick >= maxShortClickTime)&&(timeOfClick <= maxLongClickTime)){clickytype = longClick;}
    else if (timeOfClick > maxLongClickTime){clickytype = veryLongClick;}
startTime = millis();currentState = debounceTime;if(shortClickCount == 0){return clickytype;}
}
break;

case debounceTime:
if((currentTime - startTime) >= debounceWait){if(shortClickCount == 2){currentState = doubleClickChecker;}else{currentState  = idle;};
}
break;

case doubleClickChecker:
int8_t clickytype;
if((currentTime - firstShortClickStart) <= 500){clickytype = doubleClick;}
break;



}

return 0;
}







